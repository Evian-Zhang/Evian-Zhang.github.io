<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width initial-scale=1" name="viewport"/>
  <title>
   macOS上的汇编入门（二）——数学基础
  </title>
  <base target="_blank"/>
  <link href="/css/article.css" rel="stylesheet" type="text/css"/>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
   MathJax.Hub.Config({
tex2jax: {
	inlineMath: [ ['$','$'] ],
	displayMath: [ ['$$','$$'] ]
}
});
  </script>
 </head>
 <div id="main_wrapper">
  <header id="main_header">
   <a href="/index.html">
    Evian Zhang's
    <br/>
    naive blog
   </a>
   <h2>
    macOS上的汇编入门（二）——数学基础
   </h2>
  </header>  <div id="article">
   <p>
    <span>
     在正式介绍汇编语言之前，我会先用几篇文章讲一些数学基础和硬件基础。如果读者已经具备了一定的知识基础，可以直接跳过这些文章去汇编语言部分。
    </span>
   </p>
   <h1>
    <a class="md-header-anchor" name="%E4%BA%8C%E8%BF%9B%E5%88%B6%EF%BC%8C%E5%85%AB%E8%BF%9B%E5%88%B6%E4%B8%8E%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6">
    </a>
    <span>
     二进制，八进制与十六进制
    </span>
   </h1>
   <p>
    <span>
     在计算机底层的软件层面，我们通常采用二进制，八进制或十六进制来记录数字，其中最常用的是十六进制。所谓
    </span>
    n
    <span>
     进制，就是从0开始数，逢
    </span>
    n
    <span>
     进1. 比如说二进制，就是从0开始数，到1，然后到2的时候进1变成10. 八进制也是类似，但是到了十六进制就犯了难，我们的数字只有0到9这十个，并不能表示出16个呀，于是，我们默认使用了a到f这六个字母来分别表示10到15这六个数。也就是说，十进制数10对应的十六进制数是a, 十进制数26对应的十六进制数是1a. 在计算机底层，通常用
    </span>
    <code>
     0x
    </code>
    <span>
     开头表示十六进制，用
    </span>
    <code>
     0
    </code>
    <span>
     开头表示八进制，而没有前缀来表示十进制。因此，比如说以下的汇编代码（并不需要理解实际含义）
    </span>
   </p>
   <pre><code class="language-assembly" lang="assembly">movq $0x1a, %rax
</code></pre>
   <p>
    <span>
     与
    </span>
   </p>
   <pre><code class="language-assembly" lang="assembly">movq $26, %rax
</code></pre>
   <p>
    <span>
     相同。
    </span>
   </p>
   <p>
    <span>
     十进制数与十六进制数的转化可以在搜索引擎上找到，这里不再赘述。而八进制，十六进制数与二进制数的转换则十分简单。一个八进制数的一位代表一个二进制数的三位，比如说八进制数的一位
    </span>
    <code>
     5
    </code>
    <span>
     就代表二进制数的三位
    </span>
    <code>
     011
    </code>
    <span>
     ; 同理，一个十六进制数的一位就代表二进制数的四位。因此，十六进制数
    </span>
    <code>
     0x2000001
    </code>
    <span>
     就代表二进制数
    </span>
    <code>
     0010000000000000000000000001
    </code>
    <span>
     .
    </span>
   </p>
   <p>
    <span>
     我们知道，之所以使用二进制数，是因为计算机底层采用高电平/低电平这种方法来表示数。那么，我们为什么要使用八进制、十六进制呢？我们知道，如今的计算机大多采用64位系统，意思是说，任何一个地址都是一个64位二进制数。那么，如果我们只采用二进制来表示一个地址，那么得有64个
    </span>
    <code>
     0
    </code>
    <span>
     或者
    </span>
    <code>
     1
    </code>
    <span>
     , 这不仅让我们看花眼了，而且也极大的浪费了电脑的显示资源。而刚才讲到的十六进制数则帮我们解决了这个问题。我们知道，十六进制数的一位对应二进制数的4位。因此，一个
    </span>
    n
    <span>
     位二进制数，只需要
    </span>
    \lceil\frac{n}{4}\rceil
    <span>
     位十六进制数即可。也就是说，我们要表示64位的地址，只需要16位十六进制数即可。
    </span>
   </p>
   <h1>
    <a class="md-header-anchor" name="%E8%A1%A5%E7%A0%81">
    </a>
    <span>
     补码
    </span>
   </h1>
   <p>
    <span>
     进制问题解决了在计算机底层软件中数的表示问题，接下来还需要解决的是记录问题，也就是说，如何把数实际存储在64位寄存器中。我们想要解决两个问题：
    </span>
   </p>
   <ul>
    <li>
     <span>
      如何记录负数
     </span>
    </li>
    <li>
     <span>
      可以使用加法器计算减法么
     </span>
    </li>
   </ul>
   <p>
    <span>
     天才般的先行者，使用了补码来一举解决了这两个问题。
    </span>
   </p>
   <p>
    <span>
     想要解决第二个问题，一个想法自然出现了，既然
    </span>
    a-b=a+(-b)
    <span>
     , 那可以在加法器中输入一个正数和一个负数来实现减法呀。
    </span>
   </p>
   <p>
    <span>
     然而，我们知道，在计算机中，一个存储单位存储的数据大小是有上限的。比如说在64位CPU中，每个寄存器有64位，因此可以存储64位二进制数。因此，在CPU的加法器中，实际上使用了模
    </span>
    2^{64}
    <span>
     加法。也就是说，加法器做的，就是对于输入的两个64位二进制数
    </span>
    a
    <span>
     和
    </span>
    b
    <span>
     , 输出64位二进制数
    </span>
    (a+b)\bmod{2^{64}}
    <span>
     .
    </span>
   </p>
   <p>
    <span>
     因此，我们只有找到合适的将负数记录成64位二进制数的方法，才能将加法器转化为减法器。
    </span>
   </p>
   <p>
    <span>
     注意到
    </span>
   </p>
   <div cid="n22" class="mathjax-block md-end-block md-math-block md-rawblock" contenteditable="false" id="mathjax-n22" mdtype="math_block" spellcheck="false">
    <div class="md-rawblock-container md-math-container" tabindex="-1">
     <div class="MathJax_SVG_Display" style="text-align: center;">
      <span class="MathJax_SVG" id="MathJax-Element-1-Frame" style="font-size: 100%; display: inline-block;" tabindex="-1">
       <svg focusable="false" height="3.275ex" role="img" style="vertical-align: -0.972ex; max-width: 100%;" viewbox="0 -991.6 14780.8 1410.2" width="34.33ex" xmlns:xlink="http://www.w3.org/1999/xlink">
        <defs>
         <path d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z" id="E1-MJMATHI-61" stroke-width="0">
         </path>
         <path d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" id="E1-MJMAIN-2212" stroke-width="0">
         </path>
         <path d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z" id="E1-MJMATHI-62" stroke-width="0">
         </path>
         <path d="M56 444Q56 457 70 464H707Q722 456 722 444Q722 430 706 424H72Q56 429 56 444ZM56 237T56 250T70 270H707Q722 262 722 250T707 230H70Q56 237 56 250ZM56 56Q56 71 72 76H706Q722 70 722 56Q722 44 707 36H70Q56 43 56 56Z" id="E1-MJMAIN-2261" stroke-width="0">
         </path>
         <path d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z" id="E1-MJMAIN-2B" stroke-width="0">
         </path>
         <path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" id="E1-MJMAIN-28" stroke-width="0">
         </path>
         <path d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" id="E1-MJMAIN-32" stroke-width="0">
         </path>
         <path d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" id="E1-MJMAIN-36" stroke-width="0">
         </path>
         <path d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" id="E1-MJMAIN-34" stroke-width="0">
         </path>
         <path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" id="E1-MJMAIN-29" stroke-width="0">
         </path>
         <path d="M152 251Q152 646 388 850H416Q422 844 422 841Q422 837 403 816T357 753T302 649T255 482T236 250Q236 124 255 19T301 -147T356 -251T403 -315T422 -340Q422 -343 416 -349H388Q359 -325 332 -296T271 -213T212 -97T170 56T152 251Z" id="E1-MJSZ1-28" stroke-width="0">
         </path>
         <path d="M305 251Q305 -145 69 -349H56Q43 -349 39 -347T35 -338Q37 -333 60 -307T108 -239T160 -136T204 27T221 250T204 473T160 636T108 740T60 807T35 839Q35 850 50 850H56H69Q197 743 256 566Q305 425 305 251Z" id="E1-MJSZ1-29" stroke-width="0">
         </path>
         <path d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" id="E1-MJMAIN-6D" stroke-width="0">
         </path>
         <path d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" id="E1-MJMAIN-6F" stroke-width="0">
         </path>
         <path d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" id="E1-MJMAIN-64" stroke-width="0">
         </path>
        </defs>
        <g fill="currentColor" stroke="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)">
         <use x="0" xlink:href="#E1-MJMATHI-61" y="0">
         </use>
         <use x="751" xlink:href="#E1-MJMAIN-2212" y="0">
         </use>
         <use x="1751" xlink:href="#E1-MJMATHI-62" y="0">
         </use>
         <use x="2458" xlink:href="#E1-MJMAIN-2261" y="0">
         </use>
         <use x="3514" xlink:href="#E1-MJMATHI-61" y="0">
         </use>
         <use x="4265" xlink:href="#E1-MJMAIN-2B" y="0">
         </use>
         <g transform="translate(5265,0)">
          <use xlink:href="#E1-MJSZ1-28">
          </use>
          <g transform="translate(458,0)">
           <use x="0" xlink:href="#E1-MJMAIN-32" y="0">
           </use>
           <g transform="translate(500,412)">
            <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-36">
            </use>
            <use transform="scale(0.707)" x="500" xlink:href="#E1-MJMAIN-34" y="0">
            </use>
           </g>
          </g>
          <use x="1987" xlink:href="#E1-MJMAIN-2212" y="0">
          </use>
          <use x="2987" xlink:href="#E1-MJMATHI-62" y="0">
          </use>
          <use x="3416" xlink:href="#E1-MJSZ1-29" y="-1">
          </use>
         </g>
         <use x="10306" xlink:href="#E1-MJMAIN-28" y="0">
         </use>
         <g transform="translate(10695,0)">
          <use xlink:href="#E1-MJMAIN-6D">
          </use>
          <use x="833" xlink:href="#E1-MJMAIN-6F" y="0">
          </use>
          <use x="1333" xlink:href="#E1-MJMAIN-64" y="0">
          </use>
         </g>
         <g transform="translate(13084,0)">
          <use x="0" xlink:href="#E1-MJMAIN-32" y="0">
          </use>
          <g transform="translate(500,412)">
           <use transform="scale(0.707)" xlink:href="#E1-MJMAIN-36">
           </use>
           <use transform="scale(0.707)" x="500" xlink:href="#E1-MJMAIN-34" y="0">
           </use>
          </g>
         </g>
         <use x="14391" xlink:href="#E1-MJMAIN-29" y="0">
         </use>
        </g>
       </svg>
      </span>
     </div>
     <script id="MathJax-Element-1" type="math/tex; mode=display">
      a-b\equiv a+\left(2^{64}-b\right)\pmod{2^{64}}
     </script>
    </div>
   </div>
   <p>
    <span>
     而由于
    </span>
    b
    <span>
     是64位二进制数，因此，
    </span>
    2^{64}-b
    <span>
     必然是一个正数，而正数的记录方法我们是知道的。因此，我们可以使用
    </span>
    2^{64}-b
    <span>
     来记录
    </span>
    -b
    <span>
     , 其参与的减法就可以变成相应的加法。
    </span>
   </p>
   <p>
    <span>
     但是，还有一个细节需要注意。比如说，我们想要记录的二进制数是
    </span>
    <code>
     0xfffffffffffffffe
    </code>
    <span>
     , 那么根据刚刚讨论的，我们可以将其记录为
    </span>
    <code>
     0x1
    </code>
    <span>
     . 这就出现了问题，如何区分
    </span>
    <code>
     0x1
    </code>
    <span>
     和
    </span>
    <code>
     0xfffffffffffffffe
    </code>
    <span>
     呢？我们采用这种方法只是为了方便减法，并不打算将正数和负数混同啊。
    </span>
   </p>
   <p>
    <span>
     因此，在实际操作中，当出现负数时，能够允许的负数的绝对值最大值是
    </span>
    2^{63}
    <span>
     . 换句话说，其记录值最高位
    </span>
    <code>
     0
    </code>
    <span>
     表示正数，
    </span>
    <code>
     1
    </code>
    <span>
     表示负数。这种记录方法叫做
    </span>
    <strong>
     <span>
      补码
     </span>
    </strong>
    <span>
     。也就是说，对于小于
    </span>
    2^{63}
    <span>
     的正数，采用其二进制表示为其实际记录；对于不低于
    </span>
    -2^{63}
    <span>
     的负数，将其加上
    </span>
    2^{64}
    <span>
     后的正数的二进制表示为其实际记录。如果采用补码，那么可以表示
    </span>
    -2^{63}\sim2^{63}-1
    <span>
     的整数。因此，采用补码记录的数称为
    </span>
    <strong>
     <span>
      有符号整数
     </span>
    </strong>
    <span>
     。反之，如果直接使用其二进制表示为其记录的话，那么只能表示
    </span>
    0\sim 2^{64}-1
    <span>
     的整数。因此，这种数的记录形式称为
    </span>
    <strong>
     <span>
      无符号整数
     </span>
    </strong>
    <span>
     。
    </span>
   </p>
   <h1>
    <a class="md-header-anchor" name="%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97">
    </a>
    <span>
     逻辑运算
    </span>
   </h1>
   <p>
    <span>
     除了加减乘除以外，二进制数还有独特的运算——逻辑运算。分别是与(and), 或(or), 非(not)和异或(xor). 与或非大家都很熟悉了，异或就是当且仅当两个操作数不同时输出
    </span>
    <code>
     1
    </code>
    <span>
     , 相同时输出
    </span>
    <code>
     0
    </code>
    <span>
     .
    </span>
   </p>
   <h1>
    <a class="md-header-anchor" name="%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%93%AA%E7%9C%8B%E5%88%B0%E8%BF%99%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0">
    </a>
    <span>
     可以在哪看到这系列文章
    </span>
   </h1>
   <p>
    <span>
     我在我的
    </span>
    <a href="https://github.com/Evian-Zhang/Assembly-on-macOS">
     <span>
      GitHub
     </span>
    </a>
    <span>
     上，
    </span>
    <a href="https://zhuanlan.zhihu.com/c_1132336120712765440">
     <span>
      知乎专栏
     </span>
    </a>
    <span>
     上和
    </span>
    <a href="https://blog.csdn.net/EvianZhang">
     <span>
      CSDN
     </span>
    </a>
    <span>
     上同步更新。
    </span>
   </p>
   <p>
    <span>
     上一篇文章：
    </span>
    <a href="macOS上的汇编入门（一）——引言.html">
     <span>
      macOS上的汇编入门（一）——引言
     </span>
    </a>
   </p>
  </div>
 </div>
</html>